{% extends 'index.html' %} {% block title %}RFID Life Scan{% endblock %} {%
block content %}
<h1>RFID Goat ID Scanner</h1>
<h3>Goat ID: <span id="uid">Waiting...</span></h3>
<div id="details" class="details">No details available</div>

<script>
  async function fetchUID() {
    const response = await fetch("/latest_uid");
    const data = await response.json();
    const uid = data.uid || "No UID scanned";
    document.getElementById("uid").innerText = uid;

    if (uid !== "No UID scanned") {
      const detailsResponse = await fetch(`/uid_details/${uid}`);
      const details = await detailsResponse.json();
      displayDetails(details);
    } else {
      document.getElementById("details").innerHTML =
        "<p>No details available</p>";
    }
  }

  function displayDetails(details) {
    if (details) {
      document.getElementById("details").innerHTML = `
                    <table>
                        <tr><th>Goat ID</th><td>${details.uid}</td></tr>
                        <tr><th>Gender</th><td>${details.gender}</td></tr>
                        <tr><th>Breed</th><td>${details.breed}</td></tr>
                        <tr><th>Age (months)</th><td>${details.age}</td></tr>
                        <tr><th>Weight (kg)</th><td>${details.weight}</td></tr>
                        <tr><th>Register Time</th><td>${details.register_time}</td></tr>
                        <tr><th>Health Status</th><td>${details.health_status}</td></tr>
                    </table>
                    <h3>Vaccine Details</h3>
                    <table>
                        <tr><th>Vaccine Type</th><td>${details.vaccine_type}</td></tr>
                        <tr><th>Date to be Vaccinated</th><td>${details.treatment_time}</td></tr>
                        <tr><th>Next Date to be Vaccinated</th><td>${details.next_vaccine_time}</td></tr>
                    </table>`;
    } else {
      document.getElementById("details").innerHTML =
        "<p>No details available</p>";
    }
  }

  setInterval(fetchUID, 1000); // Fetch UID every second
</script>
{% endblock %}
